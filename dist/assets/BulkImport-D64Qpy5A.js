const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-BWyrxUS_.js","./router-D0s7kpEq.js","./vendor-ClZwdvRs.js","./supabase-BVyR-Bwy.js","./genai-BQQ7UKBB.js"])))=>i.map(i=>d[i]);
import{_ as y}from"./supabase-BVyR-Bwy.js";import{j as t,A as _}from"./index-BWyrxUS_.js";import{r as m}from"./router-D0s7kpEq.js";import"./vendor-ClZwdvRs.js";import"./genai-BQQ7UKBB.js";const f=c=>{const o=c.trim();if(!o)return[];try{const s=JSON.parse(o);if(Array.isArray(s))return s}catch{}const n=o.split(/\r?\n/).map(s=>s.trim()).filter(Boolean),a=[];let l=!0;for(const s of n)try{const d=JSON.parse(s);a.push(d)}catch{l=!1;break}return l&&a.length>0?a:n.map(s=>({question_type_id:"",type:"sa",question_text:s,correct_option:"",difficulty_level:"easy"}))},k=()=>{const[c,o]=m.useState(""),[n,a]=m.useState(null),[l,s]=m.useState(!1),[d,r]=m.useState(null),u=()=>{try{const e=f(c);a(e),r(`${e.length} items parsed`)}catch{a(null),r("Không thể phân tích đầu vào")}},h=async()=>{if(!n||n.length===0){r("Không có mục nào để import");return}if(n.some(i=>!i.question_type_id)){r("Một số mục chưa có `question_type_id`. Vui lòng điền trước khi import.");return}s(!0),r(null);try{await _.createQuestionsBulk(n),r("Đã import thành công"),a(null),o("")}catch(i){console.error("Bulk import error",i),r("Lỗi khi import: "+(i?.message||String(i)))}finally{s(!1)}},p=async()=>{s(!0),r("Đang gọi Gemini để sinh câu hỏi...");try{const{generateQuizQuestions:e}=await y(async()=>{const{generateQuizQuestions:x}=await import("./index-BWyrxUS_.js").then(g=>g.g);return{generateQuizQuestions:x}},__vite__mapDeps([0,1,2,3,4]),import.meta.url),i=await e(c);o(i),r("Đã nhận kết quả từ Gemini - nhấn Phân tích để xem")}catch(e){console.error("Gemini generation error",e),r("Lỗi khi gọi Gemini: "+(e?.message||String(e)))}finally{s(!1)}};return t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Dán JSON / NDJSON / TXT ở đây"}),t.jsx("textarea",{value:c,onChange:e=>o(e.target.value),rows:12,className:"w-full p-3 border rounded-md font-mono text-sm"})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:u,className:"px-4 py-2 bg-indigo-600 text-white rounded",children:"Phân tích"}),t.jsx("button",{onClick:p,disabled:!c.trim()||l,className:"px-4 py-2 bg-blue-600 text-white rounded",children:"Sinh bằng Gemini"}),t.jsx("button",{onClick:h,disabled:l,className:"px-4 py-2 bg-green-600 text-white rounded",children:"Import vào DB"})]}),d&&t.jsx("div",{className:"p-3 bg-gray-100 rounded",children:d}),n&&t.jsxs("div",{className:"bg-white border rounded p-3",children:[t.jsxs("h4",{className:"font-semibold mb-2",children:["Xem trước (",n.length,")"]}),t.jsx("div",{className:"space-y-2 max-h-64 overflow-auto",children:n.map((e,i)=>t.jsxs("div",{className:"p-2 border rounded",children:[t.jsxs("div",{className:"text-xs text-gray-500",children:[e.type," ",e.question_type_id?`| typeId: ${e.question_type_id}`:"| MISSING typeId"]}),t.jsx("div",{className:"font-medium",children:e.question_text||e.question}),e.option_a&&t.jsxs("div",{className:"text-sm",children:["A. ",e.option_a]}),e.option_b&&t.jsxs("div",{className:"text-sm",children:["B. ",e.option_b]}),e.option_c&&t.jsxs("div",{className:"text-sm",children:["C. ",e.option_c]}),e.option_d&&t.jsxs("div",{className:"text-sm",children:["D. ",e.option_d]}),t.jsxs("div",{className:"text-sm text-gray-600",children:["Đáp án: ",e.correct_option]})]},i))})]})]})};export{k as default};
